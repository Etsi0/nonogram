(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const z=document.getElementById("myCanvas"),w=z.getContext("2d");function Se(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var J,ae;function be(){if(ae)return J;ae=1;var n=4,e=.001,t=1e-7,l=10,i=11,o=1/(i-1),s=typeof Float32Array=="function";function c(y,p){return 1-3*p+3*y}function h(y,p){return 3*p-6*y}function r(y){return 3*y}function a(y,p,v){return((c(p,v)*y+h(p,v))*y+r(p))*y}function u(y,p,v){return 3*c(p,v)*y*y+2*h(p,v)*y+r(p)}function m(y,p,v,x,A){var _,C,Z=0;do C=p+(v-p)/2,_=a(C,x,A)-y,_>0?v=C:p=C;while(Math.abs(_)>t&&++Z<l);return C}function f(y,p,v,x){for(var A=0;A<n;++A){var _=u(p,v,x);if(_===0)return p;var C=a(p,v,x)-y;p-=C/_}return p}function T(y){return y}return J=function(p,v,x,A){if(!(0<=p&&p<=1&&0<=x&&x<=1))throw new Error("bezier x values must be in [0, 1] range");if(p===v&&x===A)return T;for(var _=s?new Float32Array(i):new Array(i),C=0;C<i;++C)_[C]=a(C*o,p,x);function Z(N){for(var B=0,R=1,ze=i-1;R!==ze&&_[R]<=N;++R)B+=o;--R;var ye=(N-_[R])/(_[R+1]-_[R]),Y=B+ye*o,re=u(Y,p,x);return re>=e?f(N,Y,p,x):re===0?Y:m(N,B,B+o,p,x)}return function(B){return B===0?0:B===1?1:a(Z(B),v,A)}},J}var ve=be();const H=Se(ve),P=Object.freeze({lineThickness:.125,numCells:15}),F=()=>d(16/Math.ceil(P.numCells/2.5)),g=Object.freeze({healthBar:12,toolBar:12}),S=Object.freeze({board:{left:1,top:1,right:0,bottom:0},workarea:{left:1,top:5,right:1,bottom:5,gap:1}}),xe=Object.freeze([["Logo","Phadonia.svg"],["Heart_filled","Heart_filled.svg"],["Heart_empty","Heart_empty.svg"],["X","x.svg"],["Pen","pen.svg"]]),te=_e("./assets/img/",xe),L={gameState:"Menu",total:0};//! Only change this array when the mouse moves or clicks
//! Disable click at the end of the GameLoop so the click gets only triggered on one frame
const b={click:0,x:0,y:0};function se(n,e){const t=z.getBoundingClientRect(),l=window.devicePixelRatio;return{x:(n-t.left)*l,y:(e-t.top)*l}}document.addEventListener("mousemove",n=>{const e=se(n.clientX,n.clientY);b.x=e.x,b.y=e.y});document.addEventListener("mousedown",n=>{b.click=n.buttons});document.addEventListener("touchstart",n=>{if(n.preventDefault(),n.touches.length>0){const e=n.touches[0],t=se(e.clientX,e.clientY);b.x=t.x,b.y=t.y,b.click=1}},{passive:!1});document.addEventListener("touchmove",n=>{if(n.preventDefault(),n.touches.length>0){const e=n.touches[0],t=se(e.clientX,e.clientY);b.x=t.x,b.y=t.y}},{passive:!1});document.addEventListener("contextmenu",n=>{});document.addEventListener("keydown",n=>{});function _e(n,e,t){return[...e].reduce((l,[i,o])=>{const s=new Image;return s.src=n+o,s.onload=()=>{l[i]=s,Object.keys(l).length===e.length&&fe()},s.onerror=()=>{console.error(`Failed to load image: ${s.src}`)},l},{})}function ue(){const n=window.devicePixelRatio,e=window.innerWidth,t=window.innerHeight;z.style.width=e+"px",z.style.height=t+"px",z.width=e*n,z.height=t*n,le("resize")}function U(){let n=Math.min(z.width,z.height);n=n-n*(S.workarea.left/100+S.workarea.right/100);let e=z.height;e=e-e*(S.workarea.top/100+S.workarea.bottom/100);const t=(z.width-n)*(S.workarea.left/(S.workarea.left+S.workarea.right)),l=(z.height-e)*(S.workarea.top/(S.workarea.top+S.workarea.bottom));return{height:e,width:n,x:t,y:l}}function de(){const n=U(),e=Math.min(n.width-d(20+S.board.left),n.height-d(g.healthBar+S.workarea.gap+21.5+S.board.top+S.board.bottom+S.workarea.gap+g.toolBar)),t=(e-d(P.lineThickness)*(P.numCells-1))/P.numCells,l=Math.max(n.x+d(20+S.board.left),n.x+(n.width-e)/2),i=Math.max(n.y+d(g.healthBar+S.workarea.gap+21.5+S.board.top),n.y+(n.height-e)/2);return{height:e,gridCellSize:t,width:e,x:l,y:i}}function d(n){return Math.min(z.width,z.height)*(n/100)}function le(n){oe.forEach(e=>{e[n].call(e)})}function ne(n,e,t,l){return b.x>=n&&b.x<=n+t&&b.y>=e&&b.y<=e+l}function D(n){const e=n<=.5?.4*n:.4-.4*n;w.fillStyle=`oklch(${n} ${e} 277 / 100%)`}class W{text;height;horizontalAlign="left";verticalAlign="top";width;x=0;y=0;constructor(e,t){w.font=`${t}px Inter`,w.fillStyle="white",w.textBaseline="ideographic",this.text=e;const l=w.measureText(this.text);this.height=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent+d(1),this.width=t/2*e.length}render(){switch(w.textAlign=this.horizontalAlign,this.verticalAlign){case"center":this.y+=this.height/2;break;case"bottom":this.y+=this.height;break}w.fillText(this.text,this.x,this.y)}}function Ce(n,e,t){return Math.max(n,Math.min(e,t))}class ge{startTime;duration;animationType="linear";bezier=H(0,0,1,1);constructor(e,t,...l){switch(this.startTime=Date.now(),this.duration=e,t){case"linear":this.animationType="bezier",this.bezier=H(0,0,1,1);break;case"ease":this.animationType="bezier",this.bezier=H(.25,0,.25,1);break;case"ease-in":this.animationType="bezier",this.bezier=H(.42,0,1,1);break;case"ease-out":this.animationType="bezier",this.bezier=H(0,0,.58,1);break;case"ease-in-out":this.animationType="bezier",this.bezier=H(.42,0,.58,1);break;case"bezier":this.bezier=H(...l[0]);break;default:this.animationType=t;break}}step(){const t=Date.now()-this.startTime,l=Ce(0,t/this.duration,1);switch(this.animationType){case"bezier":return this.bezier(l);case"sin":return .5*Math.sin(l*Math.PI);case"bell":const o=.25,s=.5,c=1/(o*Math.sqrt(2*Math.PI)),h=-.5*Math.pow((l-s)/o,2);return c*Math.exp(h)*o*Math.sqrt(2*Math.PI)*.5;default:return l}}isComplete(){return Date.now()-this.startTime>=this.duration}}const G=3;let K;function ke(){K=G}function Te(){K--}function Ie(){const n=U();for(let e=0;e<G;e++){const t=(n.width-d(g.healthBar)*G-d(g.healthBar/2)*(G-1))/2;w.drawImage(te[`Heart_${e<=K-1?"filled":"empty"}`],n.x+t+d(g.healthBar+g.healthBar/2)*e,n.y,d(g.healthBar),d(g.healthBar))}}let V="Pen";const E=g.toolBar*.75;let k=U(),M=(k.width-d(g.toolBar)*2-d(g.toolBar/2)*1)/2,ie=!1;function Pe(n){console.log("hej"),ie=!0,V=n}let j,$=0;function Be(){const n=k.y+k.height-d(g.toolBar);if(k=U(),M=(k.width-d(g.toolBar)*2-d(g.toolBar/2)*1)/2,ie&&(j=new ge(300,"ease-in-out")),j){switch($=j.step(),V){case"Pen":$=1-$;break}j.isComplete()&&(j=void 0)}D(.5),w.beginPath(),w.roundRect(k.x+M+d(g.toolBar+g.toolBar/2)*0,n,d(g.toolBar*2+g.toolBar/2),d(g.toolBar),d(1.75)),w.fill(),D(1),w.beginPath(),w.roundRect(k.x+M+d(g.toolBar+g.toolBar/2)*$,n,d(g.toolBar),d(g.toolBar),d(1.75)),w.fill(),w.drawImage(te.Pen,k.x+M+d(g.toolBar+g.toolBar/2)*0+d((g.toolBar-E)/2),n+d((g.toolBar-E)/2),d(E),d(E)),w.drawImage(te.X,k.x+M+d(g.toolBar+g.toolBar/2)*1+d((g.toolBar-E)/2),n+d((g.toolBar-E)/2),d(E),d(E)),ie=!1}function Ee(){ne(k.x+M+d(g.toolBar+g.toolBar/2)*0,k.y+k.height-d(g.toolBar),d(g.toolBar*2+g.toolBar/2),d(g.toolBar))&&(document.body.style.cursor="pointer",b.click===1&&Pe(V==="Pen"?"Eraser":"Pen"))}function Le(){V="Pen"}class Ae{col;row;x=0;y=0;width=0;height=0;hidden;state;constructor(e,t,l="Pen"){this.col=e,this.row=t,this.state="Eraser",this.hidden=!0,this.resize()}draw(){if(w.fillStyle="oklch(0.2 0.01 277 / 100%)",!this.hidden)switch(this.state){case"Pen":D(.625);break;case"Eraser":D(.375);break}w.fillRect(this.x,this.y,this.width,this.height)}update(){ne(this.x,this.y,this.width,this.height)&&this.hidden&&(document.body.style.cursor="pointer",b.click===1&&(this.hidden=!1,this.state==="Pen"&&L.total--,V!==this.state&&Te()))}resize(){const{gridCellSize:e,x:t,y:l}=de();this.width=e,this.height=e;const i=e+d(P.lineThickness);this.x=t+this.col*i,this.y=l+this.row*i}}class I{static removeFromArray(e,t){const l=e.indexOf(t);return l!==-1&&e.splice(l,1),e}static getZeroFilledArray(e){return new Array(e).fill(0)}static cloneArray(e){return e.slice(0)}static getRandomIntBetween(e,t){const l=Math.ceil(e),i=Math.floor(t);return Math.floor(Math.random()*(i-l+1))+l}}class Q{width;height;totalCells;cells=[];rowHints=[];columnHints=[];creator=null;grid=[];constructor(e,t){if(typeof e>"u"||typeof t>"u")throw new Error("width and height are required constructor parameters.");if(e<=0||t<=0||e===1&&t===1)throw new Error("invalid dimensions: "+e.toString()+" x "+t.toString());this.width=typeof e=="number"?e:parseInt(e,10),this.height=typeof t=="number"?t:parseInt(t,10),this.totalCells=this.width*this.height,this.reset()}reset(){const e=I.getZeroFilledArray;this.creator=null,this.cells=[],this.rowHints=[],this.columnHints=[],this.grid=e(this.height).map(()=>e(this.width))}checkUserSolution(){return this.cells.every(e=>{const t=e.userSolution===1?1:0;return e.solution===t})}getRowCells(e){const t=[],l=e*this.width,i=l+this.width;for(let o=l;o<i;o++)t.push(this.cells[o]);return t.length>0?t:!1}getColumnCells(e){const t=[];for(let l=e;l<this.cells.length;l+=this.width)t.push(this.cells[l]);return t.length>0?t:!1}getCellByIndex(e){const t=typeof e!="number"?parseInt(e,10):e;return this.cells[t]?this.cells[t]:!1}}class he{index=-1;column=-1;row=-1;solution=null;userSolution=null;aiSolution=null;constructor(e){e&&Object.assign(this,e)}}class ce{type="";index=-1;length=0;minimumSectionLength=0;sections=[];cells=[];solved=!1;constructor(e){e&&Object.assign(this,e)}}class X{puzzle;elapsedTime=0;isReset=!0;lines=[];solutionLog=[];constructor(e){this.puzzle=e,this._reset()}solve(){const e=new Date().getTime();let t=-1,l=1,i,o,s,c,h,r,a,u;for(this.isReset||this._reset(),this.isReset=!1,this._log("Starting solve algorithm","info");this._getProgress()>t&&this._getTotalSolved()<this.puzzle.cells.length;){for(o=new Date().getTime(),t=this._getProgress(),a=0;a<this.lines.length;a++)u=this.lines[a],u.solved||this.eliminateImpossibleFits(u),u.solved||this.findKnownPositivesAndNegatives(u),u.solved||this.findSectionDefiningChains(u),u.solved||this.findAnchoredSections(u),u.solved||this.findCompletedSections(u),u.solved||this.findCompletedLines(u);s=new Date().getTime(),h=(s-o)/1e3,this._log("Pass "+l+" completed in "+h+" seconds :: "+this._getTotalSolved()+"/"+this.puzzle.cells.length+" cells solved","info"),l++}return i=this._getTotalSolved()===this.puzzle.cells.length,c=new Date().getTime(),r=(c-e)/1e3,this._log("Solve algorithm finished in "+r+" seconds.","info"),i?this._log("Solution Found.","success"):this._log("Could not find solution.","failure"),this.elapsedTime=r,i}eliminateImpossibleFits(e){let t=0,l=e.length-e.minimumSectionLength,i,o,s,c,h,r,a,u,m,f;if(e.sections.length===0)for(m=0;m<e.cells.length;m++)this._setCellSolution(e.cells[m],0);for(f=0;f<e.length&&e.cells[f].aiSolution===0;f++)t++;for(f=e.length-1;f>=0&&e.cells[f].aiSolution===0;f--)l--;for(h=0;h<e.sections.length;h++){for(o=e.sections[h],c=I.cloneArray(o.possibleStartIndexes),r=0;r<o.possibleStartIndexes.length;r++)for(s=o.possibleStartIndexes[r],a=e.cells[s+o.length],(s<t||s>l)&&(c=I.removeFromArray(c,s)),a&&a.aiSolution===1&&(c=I.removeFromArray(c,s)),u=s+o.length-1,u=u>e.length-1?e.length-1:u,i=s;i<=u;i++)(i>e.length-1||e.cells[i].aiSolution===0)&&(c=I.removeFromArray(c,s));t+=o.length+1,l+=o.length+1,o.possibleStartIndexes=c}}findKnownPositivesAndNegatives(e){const t=I.getZeroFilledArray(e.length);let l,i,o,s,c,h,r,a,u,m,f;for(l=0;l<e.sections.length;l++){for(i=e.sections[l],o=I.getZeroFilledArray(e.length),s=0;s<i.possibleStartIndexes.length;s++)for(c=i.possibleStartIndexes[s],h=c,r=h+i.length-1,a=h;a<=r;a++)o[a]++,t[a]++;for(u=0;u<o.length;u++)m=o[u],f=e.cells[u],f&&f.aiSolution===null&&m===i.possibleStartIndexes.length&&this._setCellSolution(f,1)}for(u=0;u<t.length;u++)m=t[u],f=e.cells[u],f&&f.aiSolution===null&&m===0&&this._setCellSolution(f,0)}findAnchoredSections(e){let t,l,i,o;if(e.sections.length>0){for(i=e.sections[0],o=e.sections[e.sections.length-1],l=null,t=0;t<e.cells.length&&e.cells[t].aiSolution!==null;t++)if(e.cells[t].aiSolution===1){l=[t,t+i.length-1];break}if(l!==null){for(t=l[0];t<=l[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[t]&&this._setCellSolution(e.cells[t],0)}for(l=null,t=e.cells.length-1;t>=0&&e.cells[t].aiSolution!==null;t--)if(e.cells[t].aiSolution===1){l=[t-o.length+1,t];break}if(l!==null){for(t=l[0];t<=l[1];t++)e.cells[t]&&this._setCellSolution(e.cells[t],1);e.cells[l[0]-1]&&this._setCellSolution(e.cells[l[0]-1],0)}}}findSectionDefiningChains(e){let t=[],l=0,i,o,s,c,h,r;for(h=I.cloneArray(e.sections).sort(function(a,u){return a.length>u.length?-1:1}),r=h[0],i=0;i<e.cells.length;i++)o=e.cells[i],o.aiSolution===1&&(l!==1?(s={start:i,length:1},t.push(s)):s&&s.length++),l=o.aiSolution||0;for(c=0;c<t.length;c++)s=t[c],s.length===r.length&&(e.cells[s.start-1]&&this._setCellSolution(e.cells[s.start-1],0),e.cells[s.start+r.length]&&this._setCellSolution(e.cells[s.start+r.length],0),r.solved=!0)}findCompletedSections(e){let t,l,i,o;for(t=0;t<e.sections.length;t++)l=e.sections[t],!l.solved&&l.possibleStartIndexes.length===1&&(i=l.possibleStartIndexes[0]-1,o=l.possibleStartIndexes[0]+l.length,e.cells[i]&&e.cells[i].aiSolution===null&&this._setCellSolution(e.cells[i],0),e.cells[o]&&e.cells[o].aiSolution===null&&this._setCellSolution(e.cells[o],0),l.solved=!0)}findCompletedLines(e){let t=0,l=0,i,o,s,c;for(i=0;i<e.sections.length;i++)o=e.sections[i],t+=o.length;for(s=0;s<e.cells.length;s++)c=e.cells[s],l+=c.aiSolution===1?1:0;if(t===l)for(s=0;s<e.cells.length;s++)c=e.cells[s],c.aiSolution===null&&this._setCellSolution(c,0)}_reset(){const e=[],t=[];let l,i,o,s,c,h,r,a,u,m;for(this.isReset=!0,this.elapsedTime=0,this.solutionLog=[],this.lines=[],this._log("Resetting variables","info"),i=0;i<this.puzzle.cells.length;i++)this.puzzle.cells[i].aiSolution=null;for(l=0;l<this.puzzle.width;l++)e.push(l);for(l=0;l<this.puzzle.height;l++)t.push(l);for(o=0;o<this.puzzle.rowHints.length;o++)if(s=this.puzzle.rowHints[o],c=this.puzzle.getRowCells(o),c){for(h=new ce({type:"row",index:o,length:this.puzzle.width,cells:c}),r=0;r<s.length;r++)a=s[r],h.sections.push({index:r,length:a,possibleStartIndexes:[...e],knownIndexes:[],solved:!1}),h.minimumSectionLength+=a+1;h.minimumSectionLength--,this.lines.push(h)}for(u=0;u<this.puzzle.columnHints.length;u++){m=this.puzzle.columnHints[u];const f=this.puzzle.getColumnCells(u);if(f){for(h=new ce({type:"column",index:u,length:this.puzzle.height,cells:f}),r=0;r<m.length;r++)a=m[r],h.sections.push({index:r,length:a,possibleStartIndexes:[...t],knownIndexes:[],solved:!1}),h.minimumSectionLength+=a+1;h.minimumSectionLength--,this.lines.push(h)}}}_setCellSolution(e,t){let l,i,o,s,c,h,r;if(e.aiSolution===null){for(l=0;l<this.lines.length;l++)if(i=this.lines[l],o=i.type==="row"&&i.index===e.row,s=i.type==="column"&&i.index===e.column,c=0,o||s){for(h=0;h<i.cells.length;h++)r=i.cells[h],r.index===e.index?(r.aiSolution=t,c++):r.aiSolution!==null&&c++;c===i.length&&(i.solved=!0)}}}_log(e,t){this.solutionLog.push({html:e,cssClass:t||"info"})}_getTotalSolved(){let e=0;for(let t=0;t<this.puzzle.cells.length;t++)e+=this.puzzle.cells[t].aiSolution!==null?1:0;return e}_getProgress(){let e=0,t=0,l,i,o;for(l=0;l<this.lines.length;l++)for(i=this.lines[l],e+=i.sections.length*(i.type==="row"?this.puzzle.width:this.puzzle.height),o=0;o<i.sections.length;o++)t+=i.sections[o].possibleStartIndexes.length;return e-t}}class q{puzzle;log=[];creationTime=0;solvingTime=0;createRandom(e,t,l){const i=new Date().getTime();let o=!1;const s=typeof l=="number"&&l>=0&&l<=1;let c,h,r,a,u,m,f,T;for(this.puzzle=new Q(e,t),this._reset();o===!1;){for(h=s?l:I.getRandomIntBetween(200,800)/1e3,r=[],a=[],c=0,this._log("Creating random "+this.puzzle.width+"x"+this.puzzle.height+" puzzle with density of "+h+"..."),f=0;f<this.puzzle.totalCells;f++)u=Math.random()<h?1:0,c+=u,f%this.puzzle.width===0&&f>0&&(r.push(a),a=[]),a.push(u);if(c===0){this._log("Generated puzzle has no cells filled.  Trying again...");continue}else if(c===this.puzzle.totalCells){this._log("Generated puzzle has all cells filled.  Trying again...");continue}r.push(a),this.puzzle=q._populatePuzzleFromGrid(this.puzzle,r),m=new X(this.puzzle),m.solve()?(o=!0,T=(new Date().getTime()-i)/1e3,this._log("Puzzle is solvable - solved in "+m.elapsedTime+" seconds"),this._logLine(),this._log("Puzzle generated in "+T+" seconds."),this.creationTime=T,this.solvingTime=m.elapsedTime):this._log("Puzzle cannot be solved.  Trying again..."),this._logLine()}return this.puzzle.creator=this,this.puzzle}createFromGrid(e){const t=new Date().getTime();let l=0,i=0,o,s,c;if(this._reset(),this._log("creating puzzle from grid array."),!(e instanceof Array))throw new Error("grid is not an array");if(e.forEach((h,r)=>{if(!(h instanceof Array))throw new Error("grid is not a multi-dimensional array");if(l===0)l=h.length;else if(h.length!==l)throw new Error("row "+r+" has an invalid length ("+h.length+") - expecting "+l);i++}),this._log("grid is valid"),this._log("populating "+l+"x"+i+" puzzle"),o=new Q(l,i),this.puzzle=q._populatePuzzleFromGrid(o,e),this.puzzle.creator=this,s=new X(this.puzzle),s.solve())this._log("Puzzle is solvable."),this._logLine();else return this._log("Puzzle cannot be solved."),this._logLine(),!1;return c=(new Date().getTime()-t)/1e3,this._log("Puzzle built and solved in "+c+" seconds."),this._logLine(),this.puzzle}createFromHints(e){const t=new Date().getTime();let l,i,o,s,c;if(this._reset(),this._log("creating puzzle from hints"),typeof e!="object"||!e.row||!e.column)throw new Error('parameter passed to createFromHints() must be an object containing "row" and "column" properties');if(!(e.row instanceof Array)||!(e.column instanceof Array))throw new Error("hints.row or hints.column must be an array.");if(this._log("found row and column hints"),l=e.column.length,i=e.row.length,o=new Q(l,i),o.rowHints=e.row,o.columnHints=e.column,o.creator=this,this._log("populating "+l+"x"+i+" puzzle"),o.grid.forEach((h,r)=>{h.forEach((a,u)=>{o.cells.push(new he({index:r*o.width+u,column:u,row:r}))})}),this.puzzle=o,s=new X(this.puzzle),s.solve())this._log("Puzzle is solvable."),this._logLine();else return this._log("Puzzle cannot be solved."),this._logLine(),!1;return s.puzzle.cells.forEach((h,r)=>{const a=this.puzzle.getCellByIndex(r);a&&(a.aiSolution=h.aiSolution,a.solution=h.aiSolution)}),c=(new Date().getTime()-t)/1e3,this._log("Puzzle built and solved in "+c+" seconds."),this._logLine(),this.puzzle}static _populatePuzzleFromGrid(e,t){let l,i,o,s,c,h,r,a,u,m,f,T;for(e.reset(),e.grid=t,i=0;i<e.grid.length;i++){for(o=e.grid[i],u=[],e.rowHints[i]=[],s=0;s<o.length;s++)c=o[s],r=c,a=s>0?e.grid[i][s-1]:0,e.cells.push(new he({index:i*e.width+s,column:s,row:i,solution:c})),r===1&&a===0?u.push(1):r===0&&a===1?u.push(0):r===1&&a===1&&u[u.length-1]++;for(m=0;m<u.length;m++)f=u[m],f>0&&e.rowHints[i].push(f)}for(s=0;s<e.width;s++){for(e.columnHints[s]=[],l=[],h=s;h<e.totalCells;h+=e.width)T=Math.floor(h/e.width),r=e.grid[T][s],a=T>0?e.grid[T-1][s]:0,r===1&&a===0?l.push(1):r===0&&a===1?l.push(0):r===1&&a===1&&l[l.length-1]++;for(m=0;m<l.length;m++)f=l[m],f>0&&e.columnHints[s].push(f)}return e}_log(e){this.log.push(e)}_logLine(){this.log.push("-----------------------------------")}_reset(){this.log=[],this.creationTime=0,this.solvingTime=0}}addEventListener("load",ue);addEventListener("resize",ue);let O;function fe(){Re();const{height:n,gridCellSize:e,width:t,x:l,y:i}=de();switch(Ie(),D(.5),w.fillRect(l,i,t,n),le("draw"),Be(),L.gameState){case"Menu":ee("Phadonia Nonogram");break;case"Running":const o=K;if(le("update"),Ee(),o!==K&&(O=new ge(500,"bell")),O){const s=O.step();w.fillStyle=`oklch(0.6364 0.1717 23.32 / ${s})`,w.fillRect(0,0,z.width,z.height),O.isComplete()&&(O=void 0)}me.forEach((s,c)=>{s.forEach((h,r)=>{const a=new W(h.toString(),F());a.horizontalAlign="center",a.x=l+e/2+(e+d(P.lineThickness))*c,a.y=i-d(S.workarea.gap)-a.height*1.125*(s.length-1-r),a.render()})}),pe.forEach((s,c)=>{let h=s.reduce((r,a)=>r+F()/2*a.toString().length+F()/2,0);s.forEach(r=>{h-=F()/2*r.toString().length+F()/2;const a=new W(r.toString(),F());a.horizontalAlign="right",a.verticalAlign="center",a.x=l-d(S.board.left)-h,a.y=i+e/2+(e+d(P.lineThickness))*c,a.render()})}),K<=0&&(L.gameState="Lose"),L.total<=0&&(L.gameState="Win");break;case"Win":ee("Win");break;case"Lose":ee("Lose");break}b.click=0,requestAnimationFrame(fe)}function Re(){w.fillStyle="oklch(0.2 0.01 277 / 100%)",w.fillRect(0,0,z.width,z.height),document.body.style.cursor=""}function ee(n){O=void 0;let e=0,t=0,l=0,i=0;w.fillStyle="oklch(0.2 0.01 277 / 50%)",w.fillRect(0,0,z.width,z.height);const o=new W(n,d(5.4));o.horizontalAlign="center",o.verticalAlign="center",o.x=z.width*.5,o.y=z.height*.45,o.render(),D(.5),w.beginPath(),e=d(30),t=d(10),l=(z.width-e)*.5,i=(z.height-t)*.55,w.roundRect(l,i,e,t,d(1.5)),w.fill(),ne(l,i,e,t)&&(document.body.style.cursor="pointer",b.click===1&&we());const s=new W("Start",d(5.4));s.horizontalAlign="center",s.verticalAlign="center",s.x=l+e/2,s.y=i+t/2,s.render()}let oe=[],me=[],pe=[];function we(n){oe=[],L.total=0;const t=new q().createRandom(P.numCells,P.numCells);if(!t){console.error("Failed to generate puzzle");return}me=t.columnHints,pe=t.rowHints,oe=t.cells.map(l=>(l.solution===1&&L.total++,new Ae(l.column,l.row,l.solution===1?"Pen":"Eraser"))),console.log("Generated puzzle:",t),console.log("Creation time:",t.creator?.creationTime,"seconds"),console.log("Solving time:",t.creator?.solvingTime,"seconds"),n||(ke(),Le(),L.gameState="Running")}we(!0);
